# Local Research Dashboard Skill

## æ¦‚è¿°
æ¯æ¬¡ç§‘ç ”ä»»åŠ¡å¼€å§‹æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„æœ¬åœ° dashboardï¼ŒåŠ¨æ€å±•ç¤ºä»»åŠ¡å…³é”®ä¿¡æ¯å’Œäº§ç‰©é¢„è§ˆã€‚

## ç»„ä»¶
- `state.json`ï¼šæ•°æ®åè®®ï¼Œopenclaw è´Ÿè´£å†™å…¥å’Œæ›´æ–°
- `dashboard.html`ï¼šæœ¬åœ°å•æ–‡ä»¶é¡µé¢ï¼Œè½®è¯¢ state.json å¹¶æ¸²æŸ“
- `dashboard_serve.py`ï¼šé™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼Œserve ä»»åŠ¡æ ¹ç›®å½•

æ‰€æœ‰æ–‡ä»¶æ”¾åœ¨**ä»»åŠ¡ç‹¬ç«‹ç›®å½•**ä¸­ï¼ˆå¦‚ `data/<task_name>/dashboard/`ï¼‰ã€‚

---

## state.json Schema

```json
{
  "title": "ä»»åŠ¡æ ‡é¢˜",
  "updated_at": "2024-01-01 12:00:00",
  "panels": [
    {
      "type": "progress|text|list|code|table|image|files|step",
      "label": "é¢æ¿æ ‡é¢˜ï¼ˆå¯æŠ˜å çš„æ ‡è¯†ï¼‰",
      "content": "å†…å®¹ï¼ˆæ ¼å¼å–å†³äº typeï¼‰"
    }
  ]
}
```

### Panel ç±»å‹è¯´æ˜

| type | content æ ¼å¼ | ç”¨é€” | æ¸²æŸ“ |
|------|------------|------|------|
| `progress` | number (0-100) | æ•´ä½“è¿›åº¦ | **ç½®é¡¶åœ¨ header**ï¼Œä¸å‡ºç°åœ¨é¢æ¿åŒº |
| `text` | string | çŠ¶æ€æè¿°ã€æ‘˜è¦ã€å‘ç° | é¢„æ ¼å¼åŒ–æ–‡æœ¬ï¼Œè‡ªåŠ¨æ¢è¡Œ |
| `list` | string[] | æ­¥éª¤åˆ—è¡¨ã€å¾…åŠã€å·²å®Œæˆé¡¹ | å¸¦å·¦è¾¹æ¡†çš„æ¡ç›®åˆ—è¡¨ |
| `code` | string | ä»£ç ç‰‡æ®µã€å‘½ä»¤è¾“å‡º | ç­‰å®½å­—ä½“ï¼Œå¯æ»šåŠ¨ï¼Œå¸¦å¤åˆ¶æŒ‰é’® |
| `table` | `{src: "path"}` æˆ– `{headers: [...], rows: [...]}` | CSV/ç»Ÿè®¡ç»“æœ | ä»æ–‡ä»¶å®æ—¶åŠ è½½æˆ–å†…åµŒæ•°æ® |
| `image` | string æˆ– string[] | å›¾ç‰‡äº§ç‰©é¢„è§ˆ | å†…è”å›¾ç‰‡ï¼Œç‚¹å‡»æ”¾å¤§ï¼Œå¸¦ä¸‹è½½æŒ‰é’® |
| `files` | `string[] æˆ– {name, size}[]` | è¾“å‡ºç›®å½•æ–‡ä»¶åˆ—è¡¨ | å¯ç‚¹å‡»é¢„è§ˆ/ä¸‹è½½çš„æ–‡ä»¶åˆ—è¡¨ |
| `step` | `{desc, code?, outputs?}` | **æ­¥éª¤å¡ç‰‡**ï¼šå±•ç¤ºä¸€ä¸ªåˆ†ææ­¥éª¤çš„ä»£ç å’Œäº§ç‰© | ä»£ç  + äº§ç‰©é¢„è§ˆ + æè¿° |

### step ç±»å‹ï¼ˆæ ¸å¿ƒé¢æ¿ï¼‰

**ç›®æ ‡ï¼š** æ¯ä¸ªåˆ†ææ­¥éª¤ = åšäº†ä»€ä¹ˆ + è·‘äº†ä»€ä¹ˆä»£ç  + äº§å‡ºäº†ä»€ä¹ˆ

```json
{
  "type": "step",
  "label": "â‘  æ•°æ®åŠ è½½ä¸æ¸…æ´—",
  "content": {
    "desc": "åŠ è½½ CHARLS .dta æ•°æ®ï¼Œç¼–ç  8 é¡¹ ACE æŒ‡æ ‡...",
    "code": "import pandas as pd\ndf = pd.read_stata('charls.dta')\n...",
    "outputs": [
      {"kind": "text", "value": "åŸå§‹ 96,628 è¡Œ â†’ ç­›é€‰å 46,628 è¡Œï¼ˆ12,877 äººï¼‰"},
      {"kind": "image", "src": "/output/fig1_ace_distribution.png", "caption": "ACE è¯„åˆ†åˆ†å¸ƒ"},
      {"kind": "table", "src": "/output/table1_baseline.csv", "caption": "åŸºçº¿ç‰¹å¾"},
      {"kind": "file", "src": "/output/table1_baseline.csv"}
    ]
  }
}
```

#### step.content å­—æ®µ

| å­—æ®µ | å¿…å¡« | è¯´æ˜ |
|------|------|------|
| `desc` | âœ… | è¿™æ­¥åšäº†ä»€ä¹ˆã€å‘ç°äº†ä»€ä¹ˆï¼ˆå®Œæ•´å¥å­ï¼‰ |
| `code` | å¯é€‰ | æ ¸å¿ƒä»£ç ç‰‡æ®µï¼ˆé»˜è®¤æŠ˜å ï¼Œå±•ç¤ºå…³é”®é€»è¾‘ï¼‰ |
| `code_file` | å¯é€‰ | å®Œæ•´è„šæœ¬æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ `/analysis.py`ï¼‰ï¼Œå‰ç«¯æŒ‰éœ€åŠ è½½ |
| `outputs` | å¯é€‰ | äº§ç‰©åˆ—è¡¨ |

> **çº¦å®šï¼š** `code` æ”¾ç²¾åç‰‡æ®µå¸®åŠ©å¿«é€Ÿç†è§£é€»è¾‘ï¼›`code_file` æŒ‡å‘å®Œæ•´å¯è¿è¡Œçš„è„šæœ¬ã€‚ä¸¤è€…å¯åŒæ—¶å­˜åœ¨ã€‚

#### outputs[].kind

| kind | è¯´æ˜ |
|------|------|
| `text` | æ–‡å­—ç»“æœï¼ˆ`value` å­—æ®µï¼‰ |
| `image` | å›¾ç‰‡ï¼ˆ`src` è·¯å¾„ï¼Œå¯é€‰ `caption`ï¼‰ |
| `table` | è¡¨æ ¼ï¼ˆ`src` æŒ‡å‘ CSV æ–‡ä»¶è·¯å¾„ï¼Œå‰ç«¯å®æ—¶åŠ è½½è§£æï¼‰ |
| `file` | æ–‡ä»¶ä¸‹è½½é“¾æ¥ï¼ˆ`src` è·¯å¾„ï¼‰ |

### table ç±»å‹çš„ä¸¤ç§æ¨¡å¼

**æ¨¡å¼1ï¼šæ–‡ä»¶å¼•ç”¨ï¼ˆæ¨èï¼‰** â€” å‰ç«¯å®æ—¶ fetch CSV æ–‡ä»¶ï¼š
```json
{"type": "table", "label": "è¡¨1: åŸºçº¿", "content": {"src": "/output/table1.csv"}}
```

**æ¨¡å¼2ï¼šå†…åµŒæ•°æ®ï¼ˆå‘åå…¼å®¹ï¼‰** â€” æ•°æ®ç›´æ¥å†™åœ¨ state.jsonï¼š
```json
{"type": "table", "label": "è¡¨1", "content": {"headers": [...], "rows": [...]}}
```

---

## äº¤äº’åŠŸèƒ½

### å¤åˆ¶ä¸ä¸‹è½½
æ‰€æœ‰å¯é¢„è§ˆå†…å®¹éƒ½æœ‰æ“ä½œæŒ‰é’®ï¼š
- **ä»£ç å—** â†’ ã€ŒğŸ“‹ å¤åˆ¶ã€æŒ‰é’®
- **è¡¨æ ¼** â†’ ã€ŒğŸ“‹ å¤åˆ¶ TSVã€ã€Œâ¬‡ ä¸‹è½½ CSVã€æŒ‰é’®
- **å›¾ç‰‡** â†’ ã€Œâ¬‡ ä¸‹è½½ã€æŒ‰é’®
- **æ–‡æœ¬é¢„è§ˆ** â†’ ã€ŒğŸ“‹ å¤åˆ¶ã€æŒ‰é’®
- **æ–‡ä»¶åˆ—è¡¨** â†’ æ¯é¡¹å¯ç‚¹å‡»é¢„è§ˆæˆ–ä¸‹è½½

### é¢æ¿å¯æŠ˜å 
- ç‚¹å‡»é¢æ¿æ ‡é¢˜æ å¯æŠ˜å /å±•å¼€
- æŠ˜å çŠ¶æ€åœ¨åŒä¸€æ¬¡é¡µé¢ä¼šè¯ä¸­è®°å¿†
- åŠ¨ç”»æœ‰é˜»å°¼æ„Ÿï¼ˆcubic-bezier easeï¼‰

---

## é…è‰²

ä½¿ç”¨ **IBM è‰²ç›²å‹å¥½è‰²æ¿**ï¼š
- Blue: #648FFF
- Purple: #785EF0
- Magenta: #DC267F
- Orange: #FE6100
- Yellow: #FFB000

æš—è‰²èƒŒæ™¯ä½¿ç”¨ GitHub Dark è‰²ç³»ã€‚

---

## openclaw çš„èŒè´£

### 1. ä»»åŠ¡å¼€å§‹æ—¶
åœ¨ä»»åŠ¡ç›®å½•ä¸‹åˆ›å»º `dashboard/` å­ç›®å½•ï¼Œå¤åˆ¶æ¨¡æ¿æ–‡ä»¶ï¼Œç”Ÿæˆåˆå§‹ `state.json`ã€‚

### 2. æ¯ä¸ªå…³é”®æ­¥éª¤å®Œæˆå
æ›´æ–° state.jsonï¼Œ**ä½¿ç”¨ `step` é¢æ¿**ï¼š
- æ›´æ–° progress panel çš„å€¼
- ä¸ºå½“å‰æ­¥éª¤åˆ›å»º `step` panelï¼ŒåŒ…å«ï¼š
  - `desc`ï¼šè¯¦ç»†æè¿°åšäº†ä»€ä¹ˆã€å‘ç°äº†ä»€ä¹ˆ
  - `code`ï¼šå…³é”®ä»£ç ç‰‡æ®µï¼ˆä¸éœ€è¦å®Œæ•´è„šæœ¬ï¼ŒæŠ“æ ¸å¿ƒé€»è¾‘ï¼‰
  - `outputs`ï¼šè¿™æ­¥äº§å‡ºçš„æ‰€æœ‰ä¸œè¥¿ï¼ˆå›¾ç‰‡ã€è¡¨æ ¼ã€æ–‡å­—ç»“æœã€æ–‡ä»¶ï¼‰

### 3. æ–‡å­—æè¿°åŸåˆ™
- ä¸è¦åªå†™"å®Œæˆäº†"ï¼Œè¦å†™**åšäº†ä»€ä¹ˆã€å‘ç°äº†ä»€ä¹ˆ**
- ç»Ÿè®¡ç»“æœè¦å†™å…·ä½“æ•°å€¼ï¼ˆORã€CIã€på€¼ï¼‰
- æ•°æ®ç­›é€‰è¦å†™ç­›é€‰å‰åçš„æ ·æœ¬é‡å˜åŒ–
- å¼‚å¸¸/è­¦å‘Šè¦æ˜ç¡®è¯´æ˜åŸå› å’Œå½±å“

**âœ… å¥½çš„ step æè¿°ï¼š**
```json
{
  "type": "step",
  "label": "â‘  æ•°æ®åŠ è½½ä¸æ¸…æ´—",
  "content": {
    "desc": "åŠ è½½ CHARLS .dta æ•°æ®ï¼ˆ5 æ³¢æ¬¡ï¼‰ï¼Œç¼–ç  8 é¡¹ ACE æŒ‡æ ‡ï¼ˆèº«ä½“è™å¾…ã€æƒ…æ„Ÿå¿½è§†ç­‰ï¼‰ï¼Œæ„å»º 3 ä¸ª CVD ç»“å±€å˜é‡ã€‚æŒ‰å¹´é¾„â‰¥60ã€ACE éç¼ºå¤±â‰¥5 é¡¹ã€â‰¥2 æ³¢æ¬¡ç­›é€‰ï¼Œä¿ç•™ 12,877 äººï¼ˆ46,628 äººæ¬¡è§‚æµ‹ï¼‰ï¼Œæµå¤± 50.2% ä¸»è¦å› å¹´é¾„é™åˆ¶ã€‚",
    "code": "df = pd.read_stata('charls.dta')\nace_cols = ['abuse_physical', 'abuse_emotional', ...]\ndf['ace_score'] = df[ace_cols].sum(axis=1)\ndf = df[df.age >= 60]\ndf = df.groupby('id').filter(lambda x: len(x) >= 2)",
    "outputs": [
      {"kind": "text", "value": "åŸå§‹: 96,628 è¡Œ (25,873 äºº) â†’ ç­›é€‰å: 46,628 è¡Œ (12,877 äºº)"},
      {"kind": "text", "value": "ACE Cronbach's Î± = 0.477"}
    ]
  }
}
```

**âŒ å·®çš„æè¿°ï¼š**
> desc: "æ•°æ®åŠ è½½å®Œæˆ"

### 4. ä»»åŠ¡ç»“æŸæ—¶
- è¿›åº¦è®¾ä¸º 100
- æ·»åŠ  files panel åˆ—å‡ºæ‰€æœ‰äº§ç‰©
- å†™æœ€ç»ˆæ€»ç»“ step

---

## ä½¿ç”¨æ–¹å¼

**Step 1** â€” å¤åˆ¶æ¨¡æ¿åˆ°ä»»åŠ¡ç›®å½•ï¼š
```bash
TASK_DIR=/path/to/task
mkdir -p "$TASK_DIR/dashboard"
cp skills/dashboard/dashboard.html "$TASK_DIR/dashboard/"
cp skills/dashboard/dashboard_serve.py "$TASK_DIR/dashboard/"
```

**Step 2** â€” ç”Ÿæˆåˆå§‹ state.json

**Step 3** â€” å¯åŠ¨æœåŠ¡å™¨ï¼ˆserve ä»»åŠ¡æ ¹ç›®å½•ï¼‰ï¼š
```bash
python "$TASK_DIR/dashboard/dashboard_serve.py" --port 7788
# æˆ–æ˜¾å¼æŒ‡å®šæ ¹ç›®å½•ï¼š
python "$TASK_DIR/dashboard/dashboard_serve.py" --root "$TASK_DIR" --port 7788
```
Dashboard URL: `http://localhost:7788/dashboard/dashboard.html`

**Step 4** â€” å‘Šè¯‰ç”¨æˆ·æ‰“å¼€é“¾æ¥ï¼Œç„¶åæ‰§è¡Œä»»åŠ¡å¹¶æŒç»­æ›´æ–° state.json

### è·¯å¾„çº¦å®š

**é‡è¦ï¼š** `dashboard_serve.py` é»˜è®¤ serve **ä»»åŠ¡æ ¹ç›®å½•**ï¼ˆdashboard/ çš„çˆ¶ç›®å½•ï¼‰ã€‚

æ‰€æœ‰èµ„æºè·¯å¾„ä½¿ç”¨**ç»å¯¹è·¯å¾„**ï¼ˆç›¸å¯¹äº serve æ ¹ = ä»»åŠ¡æ ¹ç›®å½•ï¼‰ï¼Œä»¥ `/` å¼€å¤´ï¼š
```json
{"src": "/output/fig1.png"}
{"content": "/output/fig1.png"}
```

Dashboard URL: `http://localhost:PORT/dashboard/dashboard.html`
